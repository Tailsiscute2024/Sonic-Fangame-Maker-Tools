<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Level Maker v2.0</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f0f2f5;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .container {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 850px;
    }
    h1 {
      text-align: center;
      color: #1a73e8;
      margin-bottom: 20px;
    }
    .tile-selector {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 15px;
    }
    .tile-option {
      width: 30px;
      height: 30px;
      border: 2px solid transparent;
      cursor: pointer;
      transition: transform 0.2s;
    }
    .tile-option.selected {
      border-color: #1a73e8;
    }
    .tile-option:hover {
      transform: scale(1.1);
    }
    .grid-container {
      display: grid;
      grid-template-columns: repeat(20, 30px);
      grid-template-rows: repeat(20, 30px);
      gap: 2px;
      margin: 0 auto 20px;
    }
    .cell {
      width: 30px;
      height: 30px;
      background: #e8e8e8;
      border: 1px solid #ddd;
      cursor: pointer;
      transition: background 0.2s;
    }
    .cell:hover {
      opacity: 0.8;
    }
    .controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }
    button {
      padding: 10px 16px;
      border: none;
      border-radius: 5px;
      background: #1a73e8;
      color: white;
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover {
      background: #1557b0;
    }
    #saveBtn { background: #34a853; }
    #saveBtn:hover { background: #2d8a46; }
    #playBtn { background: #fbbc05; color: black; }
    #playBtn:hover { background: #e0a800; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Level Maker v2.0</h1>

    <div class="tile-selector">
      <div class="tile-option selected" data-type="wall" style="background:#424242;"></div>
      <div class="tile-option" data-type="floor" style="background:#8d6e63;"></div>
      <div class="tile-option" data-type="player" style="background:#2196f3;"></div>
      <div class="tile-option" data-type="enemy" style="background:#f44336;"></div>
      <div class="tile-option" data-type="start" style="background:#4caf50;"></div>
      <div class="tile-option" data-type="end" style="background:#e91e63;"></div>
    </div>

    <div class="grid-container" id="grid"></div>

    <div class="controls">
      <button id="saveBtn">üíæ Save Level</button>
      <button id="playBtn">‚ñ∂Ô∏è Playtest</button>
    </div>
  </div>

  <script>
    const gridSize = 20;
    const grid = document.getElementById('grid');
    const tileOptions = document.querySelectorAll('.tile-option');
    let selectedTile = 'wall';
    const gridData = Array(gridSize).fill().map(() => Array(gridSize).fill('empty'));

    function getTileColor(type) {
      return {
        wall: '#424242',
        floor: '#8d6e63',
        player: '#2196f3',
        enemy: '#f44336',
        start: '#4caf50',
        end: '#e91e63',
        empty: '#e8e8e8',
        trail: '#ffeb3b'
      }[type] || '#e8e8e8';
    }

    for (let i = 0; i < gridSize * gridSize; i++) {
      const cell = document.createElement('div');
      cell.className = 'cell';
      const row = Math.floor(i / gridSize);
      const col = i % gridSize;

      cell.addEventListener('click', () => {
        gridData[row][col] = selectedTile;
        cell.style.background = getTileColor(selectedTile);
      });

      grid.appendChild(cell);
    }

    tileOptions.forEach(option => {
      option.addEventListener('click', () => {
        tileOptions.forEach(o => o.classList.remove('selected'));
        option.classList.add('selected');
        selectedTile = option.dataset.type;
      });
    });

    document.getElementById('saveBtn').addEventListener('click', () => {
      const dataStr = JSON.stringify(gridData);
      const blob = new Blob([dataStr], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'level.json';
      a.click();
      URL.revokeObjectURL(url);
    });

    document.getElementById('playBtn').addEventListener('click', () => {
      let startPos = null;
      let endPos = null;

      for (let r = 0; r < gridSize; r++) {
        for (let c = 0; c < gridSize; c++) {
          if (gridData[r][c] === 'start') startPos = {row: r, col: c};
          if (gridData[r][c] === 'end') endPos = {row: r, col: c};
        }
      }

      if (!startPos || !endPos) {
        alert("Place both a green start flag and a red end flag to playtest.");
        return;
      }

      let current = {...startPos};
      const interval = setInterval(() => {
        const index = current.row * gridSize + current.col;
        grid.children[index].style.background = getTileColor('trail');

        if (current.row < endPos.row) current.row++;
        else if (current.row > endPos.row) current.row--;
        else if (current.col < endPos.col) current.col++;
        else if (current.col > endPos.col) current.col--;
        else {
          clearInterval(interval);
          alert("Playtest complete!");
        }
      }, 200);
    });
  </script>
</body>
</html>
